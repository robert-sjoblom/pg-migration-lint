---
source: src/rules/mod.rs
expression: output
---
Rule: PGM402
Severity: MINOR
Description: Missing IF NOT EXISTS on CREATE TABLE / CREATE INDEX

PGM402 â€” Missing IF NOT EXISTS on CREATE TABLE / CREATE INDEX

What it detects:
A CREATE TABLE or CREATE INDEX statement that does not include the
IF NOT EXISTS clause.

Why it matters:
Without IF NOT EXISTS, the statement fails if the object already exists.
In migration pipelines that may be re-run (e.g., idempotent migrations,
manual re-execution after partial failure), this causes hard failures.
Adding IF NOT EXISTS makes the statement idempotent.

Example:
-- Fails if 'orders' already exists:
CREATE TABLE orders (id bigint PRIMARY KEY);
CREATE INDEX idx_orders_status ON orders (status);

Recommended fix:
CREATE TABLE IF NOT EXISTS orders (id bigint PRIMARY KEY);
CREATE INDEX IF NOT EXISTS idx_orders_status ON orders (status);
