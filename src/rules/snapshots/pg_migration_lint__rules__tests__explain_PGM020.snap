---
source: src/rules/mod.rs
expression: output
---
Rule: PGM020
Severity: MINOR
Description: DISABLE TRIGGER on table suppresses FK enforcement

PGM020 — DISABLE TRIGGER on table

What it detects:
ALTER TABLE ... DISABLE TRIGGER (specific name, ALL, or USER) on
any table. Fires at MINOR on existing tables and at INFO on all
other tables (new or unknown).

Why it’s dangerous:
Disabling triggers in a migration bypasses business logic and —
critically — foreign key enforcement triggers. DISABLE TRIGGER ALL
suppresses FK checks for the duration between the disable and the
corresponding re-enable. If the re-enable is missing, omitted due
to a migration failure, or placed in a separate migration that is
never run, the integrity guarantee is permanently lost. Even
intentional disables for bulk load performance are high-risk in
migration files.

Since re-enables are not tracked, the rule fires at INFO on all
non-existing tables to flag cases where triggers may be left disabled.

Safe alternative:
Avoid disabling triggers in migrations. If you must disable
triggers for bulk data loading, ensure the DISABLE and ENABLE
are in the same migration and wrapped in a transaction.

Example (bad):
ALTER TABLE orders DISABLE TRIGGER ALL;
INSERT INTO orders SELECT * FROM staging;

Fix:
ALTER TABLE orders DISABLE TRIGGER ALL;
INSERT INTO orders SELECT * FROM staging;
ALTER TABLE orders ENABLE TRIGGER ALL;
