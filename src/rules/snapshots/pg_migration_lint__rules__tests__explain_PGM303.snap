---
source: src/rules/mod.rs
expression: output
---
Rule: PGM303
Severity: MINOR
Description: DELETE FROM existing table in migration

PGM303 â€” DELETE FROM existing table in migration

What it detects:
A DELETE FROM statement targeting a table that already exists in the
database (i.e., not created in the same set of changed files).

Why it matters:
DELETE statements in migrations remove existing data. On large tables
this can be problematic:
- Row locks are held for the full statement duration.
- Each deleted row generates WAL, which can spike replication lag.
- ON DELETE triggers fire for every row, adding overhead.
- Long-running deletes may time out under migration tool limits.
- Deleted rows become dead tuples until autovacuum runs.

Example (flagged):
DELETE FROM audit_log WHERE created_at < '2020-01-01';

Recommended approach:
1. Verify the row count is bounded.
2. For large deletes, batch in chunks (e.g., 10k rows per iteration).
3. If no triggers need to fire, consider TRUNCATE instead.

Not flagged:
- DELETE from a table created in the same migration file.

This rule is MINOR severity.
